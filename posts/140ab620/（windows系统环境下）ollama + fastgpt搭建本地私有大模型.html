<hr>
<h2 id="title-（windows系统环境下）ollama-fastgpt搭建本地私有大模型tags-安葬教程categories-本地安装部署大模型abbrlink-f8ffd5a4"><a href="#title-（windows系统环境下）ollama-fastgpt搭建本地私有大模型tags-安葬教程categories-本地安装部署大模型abbrlink-f8ffd5a4" class="headerlink" title="title: （windows系统环境下）ollama + fastgpt搭建本地私有大模型tags:  - 安葬教程categories: 本地安装部署大模型abbrlink: f8ffd5a4"></a>title: （windows系统环境下）ollama + fastgpt搭建本地私有大模型<br>tags:<br>  - 安葬教程<br>categories: 本地安装部署大模型<br>abbrlink: f8ffd5a4</h2><h2 id="（windows系统环境下）ollama-fastgpt搭建本地私有大模型"><a href="#（windows系统环境下）ollama-fastgpt搭建本地私有大模型" class="headerlink" title="（windows系统环境下）ollama + fastgpt搭建本地私有大模型"></a>（windows系统环境下）ollama + fastgpt搭建本地私有大模型</h2><p>[TOC]</p>
<h3 id="一、安装ollama"><a href="#一、安装ollama" class="headerlink" title="一、安装ollama"></a>一、安装ollama</h3><h4 id="1、安装ollama"><a href="#1、安装ollama" class="headerlink" title="1、安装ollama"></a>1、安装ollama</h4><p>下载ollama官方windows安装程序，下载后直接双击应用程序安装。</p>
<p>地址：Ollama.com</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/95791eeaca4c584a3fa12.png"></p>
<p>安装完成后进行更换ollama的存储位置</p>
<p>（设置环境变量）：</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/2c482d652c8bf28d8817d.png"></p>
<p>设置完成后重启电脑。</p>
<h4 id="2、下载模型"><a href="#2、下载模型" class="headerlink" title="2、下载模型"></a>2、下载模型</h4><p>ollama官网顶部Models，进入模型列表界面。</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/34030191822632ccec634.png"></p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/a4b93b765e4b9cd65d8a7.png"></p>
<p>复制完成后进入cmd，并开始下载模型，将复制的模型 粘贴并回车。</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/6867a5d6c0f298b65d2e8.png"></p>
<p>等待就行</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/08ad8a52551e37ebbc123.png"></p>
<p>上图为拉取进度，完成后会自动进行编译，然后本地cmd方式即可进行对话。</p>
<p>经过以上步骤本地大模型llama3以安装完成，接下来我们通过docker desktop进行搭建fastgpt。</p>
<h3 id="二、安装部署Fastgpt"><a href="#二、安装部署Fastgpt" class="headerlink" title="二、安装部署Fastgpt"></a>二、安装部署Fastgpt</h3><h4 id="1、部署fastgpt到dockerdesktop"><a href="#1、部署fastgpt到dockerdesktop" class="headerlink" title="1、部署fastgpt到dockerdesktop"></a>1、部署fastgpt到dockerdesktop</h4><p>Fastgpt开源项目地址：<a href="https://github.com/labring/FastGPT">https://github.com/labring/FastGPT</a></p>
<p>Fastgpt官方docker模式部署地址：<a href="https://doc.fastgpt.in/docs/development/docker/">https://doc.fastgpt.in/docs/development/docker/</a></p>
<p>方法如下：</p>
<p>下载 docker desktop。</p>
<p>安装 docker desktop</p>
<p>（百度，非常简单）</p>
<p>依次执行下面命令，创建 FastGPT 文件夹并下载docker-compose.yml和config.json文件，完成后目录下会有 2 个文件。</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/865c3ff67d02fc1a11604.png"></p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/f1d431750dc49be1658af.png" alt="8"></p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/3ad7f66a837e77d2052c4.png" alt="9"></p>
<p>文件创建好并拷贝出git上对应的两个文件内容，并cmd进入当前文件夹执行代码：docker-compose up -d</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/a1f9e46a65221afe4b4d3.png"></p>
<h5 id="注意：执行前修改docker-compose-yml中的内容-取消阿里云的注释，将dockerc-hub的源注释。（“自从2023年5月中旬，著名Docker-容器平台：-http-hub-docker-com-“不知”-何种原因国内均无法正常访问了。”）"><a href="#注意：执行前修改docker-compose-yml中的内容-取消阿里云的注释，将dockerc-hub的源注释。（“自从2023年5月中旬，著名Docker-容器平台：-http-hub-docker-com-“不知”-何种原因国内均无法正常访问了。”）" class="headerlink" title="注意：执行前修改docker-compose.yml中的内容,取消阿里云的注释，将dockerc hub的源注释。（“自从2023年5月中旬，著名Docker 容器平台： http://hub.docker.com “不知” 何种原因国内均无法正常访问了。”）"></a><strong>注意</strong>：<em><strong>执行前修改docker-compose.yml中的内容,取消阿里云的注释，将dockerc hub的源注释。（“自从2023年5月中旬，著名Docker 容器平台： <a href="https://link.zhihu.com/?target=http://hub.docker.com">http://hub.docker.com</a> “不知” 何种原因国内均无法正常访问了。”）</strong></em></h5><p>本人修改如下：可直接复制</p>
<h5 id="注意如果mysql端口冲突请修改端口"><a href="#注意如果mysql端口冲突请修改端口" class="headerlink" title="注意如果mysql端口冲突请修改端口"></a><strong>注意如果mysql端口冲突请修改端口</strong></h5><pre><code># 数据库的默认账号和密码仅首次运行时设置有效
# 如果修改了账号密码，记得改数据库和项目连接参数，别只改一处~
# 该配置文件只是给快速启动，测试使用。正式使用，记得务必修改账号密码，以及调整合适的知识库参数，共享内存等。
# 如何无法访问 dockerhub 和 git，可以用阿里云（阿里云没有arm包）

version: &#39;3.3&#39;
services:
  # db
  pg:
    # image: pgvector/pgvector:0.7.0-pg15 # docker hub
    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/pgvector:v0.7.0 # 阿里云
    container_name: pg
    restart: always
    ports: # 生产环境建议不要暴露
      - 5432:5432
    networks:
      - fastgpt
    environment:
      # 这里的配置只有首次运行生效。修改后，重启镜像是不会生效的。需要把持久化数据删除再重启，才有效果
      - POSTGRES_USER=username
      - POSTGRES_PASSWORD=password
      - POSTGRES_DB=postgres
    volumes:
      - ./pg/data:/var/lib/postgresql/data
  mongo:
    # image: mongo:5.0.18 # dockerhub
    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/mongo:5.0.18 # 阿里云
    # image: mongo:4.4.29 # cpu不支持AVX时候使用
    container_name: mongo
    restart: always
    ports:
      - 27017:27017
    networks:
      - fastgpt
    command: mongod --keyFile /data/mongodb.key --replSet rs0
    environment:
      - MONGO_INITDB_ROOT_USERNAME=myusername
      - MONGO_INITDB_ROOT_PASSWORD=mypassword
    volumes:
      - ./mongo/data:/data/db
    entrypoint:
      - bash
      - -c
      - |
        openssl rand -base64 128 &gt; /data/mongodb.key
        chmod 400 /data/mongodb.key
        chown 999:999 /data/mongodb.key
        echo &#39;const isInited = rs.status().ok === 1
        if(!isInited){
          rs.initiate({
              _id: &quot;rs0&quot;,
              members: [
                  { _id: 0, host: &quot;mongo:27017&quot; }
              ]
          })
        }&#39; &gt; /data/initReplicaSet.js
        # 启动MongoDB服务
        exec docker-entrypoint.sh &quot;$$@&quot; &amp;

        # 等待MongoDB服务启动
        until mongo -u myusername -p mypassword --authenticationDatabase admin --eval &quot;print(&#39;waited for connection&#39;)&quot; &gt; /dev/null 2&gt;&amp;1; do
          echo &quot;Waiting for MongoDB to start...&quot;
          sleep 2
        done

        # 执行初始化副本集的脚本
        mongo -u myusername -p mypassword --authenticationDatabase admin /data/initReplicaSet.js

        # 等待docker-entrypoint.sh脚本执行的MongoDB服务进程
        wait $$!

  # fastgpt
  sandbox:
    container_name: sandbox
    # image: ghcr.io/labring/fastgpt-sandbox:latest # git
    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt-sandbox:latest # 阿里云
    networks:
      - fastgpt
    restart: always
  fastgpt:
    container_name: fastgpt
    # image: ghcr.io/labring/fastgpt:v4.8.7 # git
    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/fastgpt:v4.8.7 # 阿里云
    ports:
      - 3000:3000
    networks:
      - fastgpt
    depends_on:
      - mongo
      - pg
      - sandbox
    restart: always
    environment:
      # root 密码，用户名为: root。如果需要修改 root 密码，直接修改这个环境变量，并重启即可。
      - DEFAULT_ROOT_PSW=1234
      # AI模型的API地址哦。务必加 /v1。这里默认填写了OneApi的访问地址。
      - OPENAI_BASE_URL=http://oneapi:3000/v1
      # AI模型的API Key。（这里默认填写了OneAPI的快速默认key，测试通后，务必及时修改）
      - CHAT_API_KEY=sk-fastgpt
      # 数据库最大连接数
      - DB_MAX_LINK=30
      # 登录凭证密钥
      - TOKEN_KEY=any
      # root的密钥，常用于升级时候的初始化请求
      - ROOT_KEY=root_key
      # 文件阅读加密
      - FILE_TOKEN_KEY=filetoken
      # MongoDB 连接参数. 用户名myusername,密码mypassword。
      - MONGODB_URI=mongodb://myusername:mypassword@mongo:27017/fastgpt?authSource=admin
      # pg 连接参数
      - PG_URL=postgresql://username:password@pg:5432/postgres
      # sandbox 地址
      - SANDBOX_URL=http://sandbox:3000
      # 日志等级: debug, info, warn, error
      - LOG_LEVEL=info
      - STORE_LOG_LEVEL=warn
    volumes:
      - ./config.json:/app/data/config.json

  # oneapi
  mysql:
    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/mysql:8.0.36 # 阿里云
    # image: mysql:8.0.36
    container_name: mysql
    restart: always
    ports:
      - 3307:3307
    networks:
      - fastgpt
    command: --default-authentication-plugin=mysql_native_password
    environment:
      # 默认root密码，仅首次运行有效
      MYSQL_ROOT_PASSWORD: oneapimmysql
      MYSQL_DATABASE: oneapi
    volumes:
      - ./mysql:/var/lib/mysql
  oneapi:
    container_name: oneapi
    # image: ghcr.io/songquanpeng/one-api:0.6.7
    image: registry.cn-hangzhou.aliyuncs.com/fastgpt/one-api:v0.6.6 # 阿里云
    ports:
      - 3001:3000
    depends_on:
      - mysql
    networks:
      - fastgpt
    restart: always
    environment:
      # mysql 连接参数
      - SQL_DSN=root:oneapimmysql@tcp(mysql:3307)/oneapi
      # 登录凭证加密密钥
      - SESSION_SECRET=oneapikey
      # 内存缓存
      - MEMORY_CACHE_ENABLED=true
      # 启动聚合更新，减少数据交互频率
      - BATCH_UPDATE_ENABLED=true
      # 聚合更新时长
      - BATCH_UPDATE_INTERVAL=10
      # 初始化的 root 密钥（建议部署完后更改，否则容易泄露）
      - INITIAL_ROOT_TOKEN=fastgpt
    volumes:
      - ./oneapi:/data
networks:
  fastgpt:
</code></pre>
<p>然后等待安装完成（由于我电脑已经完成安装，就不演示了）。完成后docker desktop会显示如下信息：</p>
<p>docker desktop内容：</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/f008bc1ec6184d7486774.png"></p>
<h4 id="2、启动并配置one-api模型："><a href="#2、启动并配置one-api模型：" class="headerlink" title="2、启动并配置one api模型："></a>2、启动并配置one api模型：</h4><p>访问本地部署好的one api：<a href="http://localhost:3001/">http://localhost:3001</a></p>
<p>初始化的    用户名:root   密码：123456</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/fe7886252f4a7e4b418b8.jpg"></p>
<p>进入后会叫修改密码之类的，完成后点击“渠道”，配置自己的大语言模型。首次登录进来空的，需要自己添加自己的大模型。</p>
<p>接下来配置刚刚安装的本地大模型llama3呢？</p>
<p>第一步：先点击 底部“添加新的渠道”，然后选择“Ollama”。</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/6dfcbd0794ee22f1dc615.jpg"></p>
<p>第二步：配置本地llama3大模型</p>
<p>查询本地ollama中的模型名称，填入模型的时候用到</p>
<p>完整的配置界面</p>
<p>完成后测试通过，下图中有时间返回，就说明模型链接成功。</p>
<p>oneapi还有最后一步，就是将模型加入到自己的令牌中，点击顶部“令牌”导航进入。选默认的令牌信息，并添加ollama3模型。</p>
<h3 id="三、配置Fastgpt"><a href="#三、配置Fastgpt" class="headerlink" title="三、配置Fastgpt"></a>三、配置Fastgpt</h3><p>接下来配置Fastgpt并使用咱们导入的本地大模型llama3来进行创建chat 或者 agent了。</p>
<p>1、配置fastgpt的模型<br>进入最开始的fastgpt文件夹。找到config.json,配置llama3模型，位置和代码如下：</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/1b04db794f4f6408851a5.jpg"></p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/c644551376e684c1f5322.jpg"></p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/9c9a916640758cee34dbd.jpg"></p>
<p>完成配置后需要重新启动docker  desktop里面的oneapi和fastgpt。</p>
<p>2、访问fastgpt<br>地址：<a href="http://localhost:3000，默认用户名：root">http://localhost:3000，默认用户名：root</a>  密码：1234</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/a1f766c1e1a33cdcbb135.jpg"></p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/ede806ff36b5627390923.png"></p>
<p>2、配置应用chat、agent等：</p>
<p><img src="https://telegraph-image-a7r.pages.dev/file/039d2ac9efeff6c2b54e3.jpg"></p>
<p>选择一个大模型，配置到你创建的应用中。</p>
<p>完成模型选择后进行 发布，发布后即可在右变边的聊天框中输入信息，进行对话。</p>
